from itertools import product
import re
from django.http import HttpResponse
from django.shortcuts import get_object_or_404, redirect, render
from .models import Project, Link
from .forms import Links, ProjectName, SubdomainForm

# Create your views here.


def index(request):

    return render(request, 'index.html')


def projects(request):

    projects = Project.objects.all()
    return render(request, 'projects.html', {'projects': projects})


def create_project(request):

    form = ProjectName(request.POST or None)

    if request.method == 'GET':

        context = {
            'form': form,
        }

        return render(request, 'projectinput.html', context)
    elif request.method == 'POST':

        if form.is_valid():
            form.save()

        return redirect('core:subdomain', id=form.instance.id)


def subdomain_enumarotor(request, id):
    try:
        project_id = get_object_or_404(Project, id = id)
        project_id = project_id.id
        links = Link.objects.filter( project_id = id)
        all_links = ''
        for i in links:
            all_links = all_links + str(i) + '\r\n'
    except:
        print('There is no enumareted links.')
    
    


    try:
        sub_data = {'subdomains':all_links}
        link_data = {'links':all_links}
    except:
        link_data = {'links':'There is no project with that id'}
        sub_data = {'subdomains':'There is no project with that id'}

    links_form = Links(request.POST or None, initial=link_data)
    subodmains_form = SubdomainForm(request.POST or None, initial=sub_data)





    if request.method == 'GET':
        context = {
            'links': links_form,
            'subdomains': subodmains_form
        }
        return render(request, 'enumarator.html', context)

    elif request.method == 'POST':
        if 'link-box' in request.POST:
            if links_form.is_valid():
                # all_links = links_form.cleaned_data['links']
                # print(links_form.cleaned_data[''])
                links_form.save(id)
            return redirect(request.META['HTTP_REFERER'])
###Gelecek i√ßin
        elif 'subdomains' in request.POST:
            if subodmains_form.is_valid():
                pass
            print('subs')
            return redirect(request.META['HTTP_REFERER'])
